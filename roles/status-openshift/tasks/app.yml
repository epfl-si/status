- tags: always
  include_vars: ../vars/main.yml

- name: Pull Secret
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      type: kubernetes.io/dockerconfigjson
      metadata:
        name: status-pull-secret
        namespace: "{{ openshift_namespace }}"
      data:
        .dockerconfigjson: "{{ pull_secret_config | to_json | b64encode }}"

- name: NetworkPolicy - Clickhouse
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: NetworkPolicy
      metadata:
        name: oneuptime-clickhouse
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/part-of: clickhouse
          app.kubernetes.io/component: clickhouse
      spec:
        podSelector:
          matchLabels:
            app.kubernetes.io/instance: oneuptime
            app.kubernetes.io/name: clickhouse
            app.kubernetes.io/part-of: clickhouse
            app.kubernetes.io/component: clickhouse
        policyTypes:
          - Ingress
          - Egress
        egress:
          - {}
        ingress:
          - ports:
            - port: 8123
            - port: 9000
            - port: 9004
            - port: 9005
            - port: 9009

# - name: NetworkPolicy - Postgres
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: NetworkPolicy
#       metadata:
#         name: oneuptime-postgresql
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#           app.kubernetes.io/component: primary
#       spec:
#         podSelector:
#           matchLabels:
#             app.kubernetes.io/instance: oneuptime
#             app.kubernetes.io/name: postgresql
#             app.kubernetes.io/component: primary
#         policyTypes:
#           - Ingress
#           - Egress
#         egress:
#           - ports:
#             - port: 53
#               protocol: UDP
#             - port: 53
#               protocol: TCP
#           - ports:
#               - port: 5432
#               - port: 5432
#             to:
#               - podSelector:
#                   matchLabels:
#                     app.kubernetes.io/instance: oneuptime
#                     app.kubernetes.io/name: postgresql
#                     app.kubernetes.io/component: read
#         ingress:
#           - ports:
#             - port: 5432
            
# - name: NetworkPolicy - Postgres - Read
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: NetworkPolicy
#       metadata:
#         name: oneuptime-postgresql-read
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#           app.kubernetes.io/component: read
#       spec:
#         podSelector:
#           matchLabels:
#             app.kubernetes.io/instance: oneuptime
#             app.kubernetes.io/name: postgresql
#             app.kubernetes.io/component: read
#         policyTypes:
#           - Ingress
#           - Egress
#         egress:
#           - ports:
#             - port: 53
#               protocol: UDP
#             - port: 53
#               protocol: TCP
#           - ports:
#               - port: 5432
#               - port: 5432
#             to:
#               - podSelector:
#                   matchLabels:
#                     app.kubernetes.io/instance: oneuptime
#                     app.kubernetes.io/name: postgresql
#                     app.kubernetes.io/component: primary
#         ingress:
#           - ports:
#             - port: 5432

- name: NetworkPolicy - Redis
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: NetworkPolicy
      metadata:
        name: oneuptime-redis
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      spec:
        podSelector:
          matchLabels:
            app.kubernetes.io/instance: oneuptime
            app.kubernetes.io/name: redis
        policyTypes:
          - Ingress
          - Egress
        egress:
          - {}
        ingress:
          - ports:
            - port: 6379

- name: ServiceAccount - Clickhouse
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: oneuptime-clickhouse
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
      automountServiceAccountToken: false

# - name: ServiceAccount - Postgres
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: ServiceAccount
#       metadata:
#         name: oneuptime-postgresql
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#       automountServiceAccountToken: false

- name: ServiceAccount - Redis
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: oneuptime-redis-master
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      automountServiceAccountToken: false

- name: Secret - Clickhouse - Init Scripts
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: oneuptime-clickhouse-init-scripts
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse
      stringData:
        db-init.sql: |
          CREATE DATABASE oneuptime;

- name: Secret - Clickhouse - Admin password
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: oneuptime-clickhouse
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse
      type: Opaque
      data:
        admin-password: "Y3oyUjB2UEw5Tg=="

# - name: Secret - Postgres - Password
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: Secret
#       metadata:
#         name: oneuptime-postgresql
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#       type: Opaque
#       data:
#         postgres-password: "OVZjSkF6N3A0Qg=="
#         password: "Z3Z0Wlg5aVdSZA=="

- name: Secret - Redis - Password
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: oneuptime-redis
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      type: Opaque
      data:
        redis-password: "OHd3U3hlc0lCdg=="

- name: Secret - OneUptime
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: oneuptime-secrets
        namespace: "{{ openshift_namespace }}"
        annotations:
          "helm.sh/resource-policy": "keep"
      type: Opaque
      stringData:
        internal-smtp: "pzkr6PlY97BCrM3ffveYnnmnSBOAsvct"
        oneuptime-secret: "dJdlGHTRUpFo4HWCdCGmRgWnIa4vFv4D"
        encryption-secret: "TNm7m8Uaa8I4CmtBboZmeyNxtnsjs7l0"
        probe-one: "U7XjKpHQZcyG0JOgeS2WzhJ61u2ZKpsk"

- name: ConfigMap - Clickhouse
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: oneuptime-clickhouse-configd
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse
      data:
        99-disable-db-interface.xml: |
          <clickhouse>
            <mysql_port remove='1'></mysql_port>
            <postgresql_port remove='1'></postgresql_port>
            <tcp_port remove='1'></tcp_port>
          </clickhouse>
        01-listen.xml: |
          <yandex>
              <listen_host>::</listen_host>
              <listen_host>0.0.0.0</listen_host>
              <listen_try>1</listen_try>
          </yandex>
        02-logger.xml: |
          <yandex>
              <logger>
                  <level>information</level>
              </logger>
          </yandex>
        03-macros.xml: |
          <yandex>
              <macros>
                  <shard from_env="CLICKHOUSE_SHARD_ID"></shard>
                  <replica from_env="CLICKHOUSE_REPLICA_ID"></replica>
                  <layer>oneuptime-clickhouse</layer>
              </macros>
          </yandex>

- name: ConfigMap - Redis - Configuration
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: oneuptime-redis-configuration
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      data:
        redis.conf: |-
          # User-supplied common configuration:
          appendonly no
          save ""
          # End of common configuration
        master.conf: |-
          dir /data
          # User-supplied master configuration:
          rename-command FLUSHDB ""
          rename-command FLUSHALL ""
          # End of master configuration
        replica.conf: |-
          dir /data
          # User-supplied replica configuration:
          rename-command FLUSHDB ""
          rename-command FLUSHALL ""
          # End of replica configuration

- name: ConfigMap - Redis - Health
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: oneuptime-redis-health
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      data:
        ping_readiness_local.sh: |-
          #!/bin/bash

          [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
          [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
          response=$(
            timeout -s 15 $1 \
            redis-cli \
              -h localhost \
              -p $REDIS_PORT \
              ping
          )
          if [ "$?" -eq "124" ]; then
            echo "Timed out"
            exit 1
          fi
          if [ "$response" != "PONG" ]; then
            echo "$response"
            exit 1
          fi
        ping_liveness_local.sh: |-
          #!/bin/bash

          [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
          [[ -n "$REDIS_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_PASSWORD"
          response=$(
            timeout -s 15 $1 \
            redis-cli \
              -h localhost \
              -p $REDIS_PORT \
              ping
          )
          if [ "$?" -eq "124" ]; then
            echo "Timed out"
            exit 1
          fi
          responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
          if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ] && [ "$responseFirstWord" != "MASTERDOWN" ]; then
            echo "$response"
            exit 1
          fi
        ping_readiness_master.sh: |-
          #!/bin/bash

          [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"
          [[ -n "$REDIS_MASTER_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_MASTER_PASSWORD"
          response=$(
            timeout -s 15 $1 \
            redis-cli \
              -h $REDIS_MASTER_HOST \
              -p $REDIS_MASTER_PORT_NUMBER \
              ping
          )
          if [ "$?" -eq "124" ]; then
            echo "Timed out"
            exit 1
          fi
          if [ "$response" != "PONG" ]; then
            echo "$response"
            exit 1
          fi
        ping_liveness_master.sh: |-
          #!/bin/bash

          [[ -f $REDIS_MASTER_PASSWORD_FILE ]] && export REDIS_MASTER_PASSWORD="$(< "${REDIS_MASTER_PASSWORD_FILE}")"
          [[ -n "$REDIS_MASTER_PASSWORD" ]] && export REDISCLI_AUTH="$REDIS_MASTER_PASSWORD"
          response=$(
            timeout -s 15 $1 \
            redis-cli \
              -h $REDIS_MASTER_HOST \
              -p $REDIS_MASTER_PORT_NUMBER \
              ping
          )
          if [ "$?" -eq "124" ]; then
            echo "Timed out"
            exit 1
          fi
          responseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')
          if [ "$response" != "PONG" ] && [ "$responseFirstWord" != "LOADING" ]; then
            echo "$response"
            exit 1
          fi
        ping_readiness_local_and_master.sh: |-
          script_dir="$(dirname "$0")"
          exit_status=0
          "$script_dir/ping_readiness_local.sh" $1 || exit_status=$?
          "$script_dir/ping_readiness_master.sh" $1 || exit_status=$?
          exit $exit_status
        ping_liveness_local_and_master.sh: |-
          script_dir="$(dirname "$0")"
          exit_status=0
          "$script_dir/ping_liveness_local.sh" $1 || exit_status=$?
          "$script_dir/ping_liveness_master.sh" $1 || exit_status=$?
          exit $exit_status

- name: ConfigMap - Redis - Scripts
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: oneuptime-redis-scripts
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      data:
        start-master.sh: |
          #!/bin/bash

          [[ -f $REDIS_PASSWORD_FILE ]] && export REDIS_PASSWORD="$(< "${REDIS_PASSWORD_FILE}")"
          if [[ -f /opt/bitnami/redis/mounted-etc/master.conf ]];then
              cp /opt/bitnami/redis/mounted-etc/master.conf /opt/bitnami/redis/etc/master.conf
          fi
          if [[ -f /opt/bitnami/redis/mounted-etc/redis.conf ]];then
              cp /opt/bitnami/redis/mounted-etc/redis.conf /opt/bitnami/redis/etc/redis.conf
          fi
          ARGS=("--port" "${REDIS_PORT}")
          ARGS+=("--requirepass" "${REDIS_PASSWORD}")
          ARGS+=("--masterauth" "${REDIS_PASSWORD}")
          ARGS+=("--include" "/opt/bitnami/redis/etc/redis.conf")
          ARGS+=("--include" "/opt/bitnami/redis/etc/master.conf")
          exec redis-server "${ARGS[@]}"

- name: Service - Clickhouse - Headless
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-clickhouse-headless
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse
      spec:
        type: ClusterIP
        clusterIP: None
        publishNotReadyAddresses: true
        ports:
          - name: http
            targetPort: http
            port: 8123
            protocol: TCP
          - name: tcp
            targetPort: tcp
            port: 9000
            protocol: TCP
          - name: tcp-mysql
            targetPort: tcp-mysql
            port: 9004
            protocol: TCP
          - name: tcp-postgresql
            targetPort: tcp-postgresql
            port: 9005
            protocol: TCP
          - name: http-intersrv
            targetPort: http-intersrv
            port: 9009
            protocol: TCP
        selector:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse

- name: Service - Clickhouse
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-clickhouse
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse
        annotations:
          {}
      spec:
        type: ClusterIP
        sessionAffinity: None
        ports:
          - name: http
            targetPort: http
            port: 8123
            protocol: TCP
            nodePort: null
          - name: tcp
            targetPort: tcp
            port: 9000
            protocol: TCP
            nodePort: null
          - name: tcp-mysql
            targetPort: tcp-mysql
            port: 9004
            protocol: TCP
            nodePort: null
          - name: tcp-postgresql
            targetPort: tcp-postgresql
            port: 9005
            protocol: TCP
            nodePort: null
          - name: http-intersrv
            targetPort: http-intersrv
            port: 9009
            protocol: TCP
            nodePort: null
        selector:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse

# - name: Service - Postgres - Headless
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: Service
#       metadata:
#         name: oneuptime-postgresql-headless
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#           app.kubernetes.io/component: primary
#         annotations:
#           service.alpha.kubernetes.io/tolerate-unready-endpoints: "true"
#       spec:
#         type: ClusterIP
#         clusterIP: None
#         publishNotReadyAddresses: true
#         ports:
#           - name: tcp-postgresql
#             port: 5432
#             targetPort: tcp-postgresql
#         selector:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/component: primary

# - name: Service - Postgres
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: Service
#       metadata:
#         name: oneuptime-postgresql
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#           app.kubernetes.io/component: primary
#       spec:
#         type: ClusterIP
#         sessionAffinity: None
#         ports:
#           - name: tcp-postgresql
#             port: 5432
#             targetPort: tcp-postgresql
#             nodePort: null
#         selector:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/component: primary

- name: Service - Redis - Headless
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-redis-headless
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      spec:
        type: ClusterIP
        clusterIP: None
        ports:
          - name: tcp-redis
            port: 6379
            targetPort: redis
        selector:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/name: redis

- name: Service - Redis
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-redis-master
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
      spec:
        type: ClusterIP
        internalTrafficPolicy: Cluster
        sessionAffinity: None
        ports:
          - name: tcp-redis
            port: 6379
            targetPort: redis
            nodePort: null
        selector:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/name: redis
          app.kubernetes.io/component: master

- name: Service - OneUptime - Accounts
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-accounts
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-accounts
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3003
            targetPort: 3003
            name: port
        selector:
            app: oneuptime-accounts
        type: ClusterIP

- name: Service - OneUptime - Admin Dashboard
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-admin-dashboard
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-admin-dashboard
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3158
            targetPort: 3158
            name: port
        selector:
            app: oneuptime-admin-dashboard
        type: ClusterIP

- name: Service - OneUptime - API reference
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-api-reference
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-api-reference
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 1446
            targetPort: 1446
            name: port
        selector:
            app: oneuptime-api-reference
        type: ClusterIP

- name: Service - OneUptime - App
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-app
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-app
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3002
            targetPort: 3002
            name: port
        selector:
            app: oneuptime-app
        type: ClusterIP

- name: Service - OneUptime - Dashboard
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-dashboard
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-dashboard
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3009
            targetPort: 3009
            name: port
        selector:
            app: oneuptime-dashboard
        type: ClusterIP

- name: Service - OneUptime - Docs
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-docs
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-docs
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 1447
            targetPort: 1447
            name: port
        selector:
            app: oneuptime-docs
        type: ClusterIP

- name: Service - OneUptime - Fluent Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-fluent-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-fluent-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3401
            targetPort: 3401
            name: port
        selector:
            app: oneuptime-fluent-ingest
        type: ClusterIP

- name: Service - OneUptime - Haraka
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-haraka
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-haraka
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - name: pop3
            protocol: TCP
            port: 110
            targetPort: 110
          - name: imap
            protocol: TCP
            port: 143
            targetPort: 143
          - name: pop3s
            protocol: TCP
            port: 995
            targetPort: 995
          - name: imaps
            protocol: TCP
            port: 993
            targetPort: 993
          - name: smtp
            protocol: TCP
            port: 25
            targetPort: 25
          - name: submission
            protocol: TCP
            port: 587
            targetPort: 587
          - name: smtps
            protocol: TCP
            port: 465
            targetPort: 465
          - name: haraka
            protocol: TCP
            port: 2525
            targetPort: 2525
        selector:
            app: oneuptime-internalSmtp
        type: ClusterIP

- name: Service - OneUptime - Home
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-home
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-home
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 1444
            targetPort: 1444
            name: port
        selector:
            app: oneuptime-home
        type: ClusterIP

- name: Service - OneUptime - Incoming Request Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-incoming-request-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-incoming-request-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3402
            targetPort: 3402
            name: port
        selector:
            app: oneuptime-incoming-request-ingest
        type: ClusterIP

- name: Service - OneUptime - Isolated VM
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-isolated-vm
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-isolated-vm
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 4572
            targetPort: 4572
            name: port
        selector:
            app: oneuptime-isolated-vm
        type: ClusterIP

- name: Service - OneUptime - Nginx
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-nginx
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-nginx
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 80
            targetPort: 7849
            name: oneuptime-http
          - port: 443
            targetPort: 7850
            name: statuspage-ssl
        selector:
            app: oneuptime-nginx
        type: ClusterIP

- name: Service - OneUptime - Open Telemetry Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-open-telemetry-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-open-telemetry-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3403
            targetPort: 3403
            name: port
        selector:
            app: oneuptime-open-telemetry-ingest
        type: ClusterIP

- name: Service - OneUptime - Otel Collector
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-otel-collector
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-otel-collector
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 4317
            targetPort: 4317
            name: grpc
          - port: 4318
            targetPort: 4318
            name: http
        selector:
            app: oneuptime-otel-collector
        type: ClusterIP

- name: Service - OneUptime - Probe Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-probe-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-probe-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3400
            targetPort: 3400
            name: port
        selector:
            app: oneuptime-probe-ingest
        type: ClusterIP

- name: Service - OneUptime - Server Monitor Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-server-monitor-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-server-monitor-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3404
            targetPort: 3404
            name: port
        selector:
            app: oneuptime-server-monitor-ingest
        type: ClusterIP

- name: Service - OneUptime - Status Page
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-status-page
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-status-page
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3105
            targetPort: 3105
            name: port
        selector:
            app: oneuptime-status-page
        type: ClusterIP

- name: Service - OneUptime - Worker
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-worker
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-worker
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 1445
            targetPort: 1445
            name: port
        selector:
            app: oneuptime-worker
        type: ClusterIP

- name: Service - OneUptime - Workflow
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: oneuptime-workflow
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-workflow
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
        annotations:
      spec:
        ports:
          - port: 3099
            targetPort: 3099
            name: port
        selector:
            app: oneuptime-workflow
        type: ClusterIP

- name: Deployment - OneUptime - Accounts
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-accounts
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-accounts
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-accounts
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-accounts
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/accounts:{{ app_images_tag }}"
                name: oneuptime-accounts
                imagePullPolicy: Always
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'false'
                  - name: DISABLE_TELEMETRY
                    value: 'false'
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: '3003'
                ports:
                  - containerPort: 3003
                    protocol: TCP
                    name: port
            restartPolicy: Always

- name: Deployment - OneUptime - Admin Dashboard
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-admin-dashboard
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-admin-dashboard
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-admin-dashboard
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-admin-dashboard
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/admin-dashboard:{{ app_images_tag }}"
                name: oneuptime-admin-dashboard
                imagePullPolicy: Always
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'false'
                  - name: DISABLE_TELEMETRY
                    value: 'false'
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: '3158'
                ports:
                  - containerPort: 3158
                    protocol: TCP
                    name: port
            restartPolicy: Always

- name: Deployment - OneUptime - API reference
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-api-reference
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-api-reference
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-api-reference
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-api-reference
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/api-reference:{{ app_images_tag }}"
                name: oneuptime-api-reference
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 1446
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 1446
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 1446
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: PORT
                    value: "1446"
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 1446
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - App
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-app
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-app
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-app
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-app
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/app:{{ app_images_tag }}"
                name: oneuptime-app
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Liveness probe
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3002
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3002
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3002
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "3002"
                  - name: SMS_HIGH_RISK_COST_IN_CENTS
                    value: 
                  - name: CALL_HIGH_RISK_COST_IN_CENTS_PER_MINUTE
                    value: 
                  - name: SMS_DEFAULT_COST_IN_CENTS
                    value: 
                  - name: CALL_DEFAULT_COST_IN_CENTS_PER_MINUTE
                    value: 
                  - name: INTERNAL_SMTP_HOST
                    value: 
                  - name: INTERNAL_SMTP_FROM_NAME
                    value: 
                  - name: INTERNAL_SMTP_EMAIL
                    value:
                  - name: INTERNAL_SMTP_PASSWORD
                    value:
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3002
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Dashboard
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-dashboard
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-dashboard
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-dashboard
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-dashboard
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/dashboard:{{ app_images_tag }}"
                name: oneuptime-dashboard
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'false'
                  - name: DISABLE_TELEMETRY
                    value: 'false'
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: '3009'
                ports:
                  - containerPort: 3009
                    protocol: TCP
                    name: port
            restartPolicy: Always

- name: Deployment - OneUptime - Docs
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-docs
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-docs
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-docs
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-docs
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/docs:{{ app_images_tag }}"
                name: oneuptime-docs
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 1447
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 1447
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 1447
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: PORT
                    value: "1447"
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 1447
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Fluent Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-fluent-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-fluent-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-fluent-ingest
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-fluent-ingest
              appname: oneuptime
          spec:
            volumes:
            - name: greenlockrc
              emptyDir:
                sizeLimit: "1Gi"
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/fluent-ingest:{{ app_images_tag }}"
                name: oneuptime-fluent-ingest
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3401
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3401
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3401
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "3401" 
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3401
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Haraka
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-haraka
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-haraka
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-haraka
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-haraka
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            volumes:
              - name: haraka-queue
                emptyDir:
                  sizeLimit: 1Gi
            containers:
              - image: "{{ quay_registry }}/haraka:{{ app_images_tag }}"
                name: oneuptime-haraka
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  - name: DKIM_PRIVATE_KEY
                    value: 
                  - name: DKIM_PUBLIC_KEY
                    value: 
                  - name: DKIM_SELECTOR
                    value: 'oneuptime'
                  - name: DOMAIN
                    value: 
                  - name: INCOMING_EMAIL_DOMAIN
                    value: 
                  - name: SMTP_EMAIL
                    value: 
                  - name: SMTP_PASSWORD
                    value: 'internal_smtp_password'
                volumeMounts:
                  - name: haraka-queue
                    mountPath: /harakaapp/queue
                ports:
                  - containerPort: 2525
                    protocol: TCP
                    name: port
            restartPolicy: Always

- name: Deployment - OneUptime - Home
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-home
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-home
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-home
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-home
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/home:{{ app_images_tag }}"
                name: oneuptime-home
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 1444
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 1444
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 1444
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: PORT
                    value: "1444"
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 1444
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Incoming Request Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-incoming-request-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-incoming-request-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-incoming-request-ingest
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-incoming-request-ingest
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/incoming-request-ingest:{{ app_images_tag }}"
                name: oneuptime-incoming-request-ingest
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3402
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3402
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3402
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "3402" 
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3402
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Isolated VM
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-isolated-vm
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-isolated-vm
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-isolated-vm
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-isolated-vm
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/isolated-vm:{{ app_images_tag }}"
                name: oneuptime-isolated-vm
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "4572" 
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 4572
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Nginx
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-nginx
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-nginx
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-nginx
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-nginx
              appname: oneuptime
          spec:
            volumes:
              - name: status-page-certs
                emptyDir:
                  sizeLimit: "1Gi"
              - name: cache
                emptyDir:
                  sizeLimit: "1Gi"
              - name: conf
                emptyDir:
                  sizeLimit: "1Gi"
              - name: run
                emptyDir:
                  sizeLimit: "1Gi"
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/nginx:{{ app_images_tag }}"
                name: oneuptime-nginx
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 7851
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 7851
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 7851
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                volumeMounts:
                  - name: status-page-certs
                    mountPath: /etc/nginx/certs/StatusPageCerts
                  - name: cache
                    mountPath: /var/cache/nginx
                  - name: conf
                    mountPath: /etc/nginx/conf.d
                  - name: run
                    mountPath: /var/run
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: NGINX_LISTEN_ADDRESS
                    value: ""
                  - name: NGINX_LISTEN_OPTIONS
                    value: ""
                  - name: ONEUPTIME_HTTP_PORT
                    value: "80"
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "7851" # Port for the nodejs server for live and ready status
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 7849
                    protocol: TCP
                    name: oneuptime-http
                    # If you are connecting Status Pages to custom domains, then this will be the port where the status page will be hosted on.
                  - containerPort: 7850
                    protocol: TCP
                    name: statuspage-ssl
            restartPolicy: Always

- name: Deployment - OneUptime - Open Telemetry Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-open-telemetry-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-open-telemetry-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-open-telemetry-ingest
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-open-telemetry-ingest
              appname: oneuptime
          spec:
            volumes:
              - name: greenlockrc
                emptyDir:
                  sizeLimit: "1Gi"
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/open-telemetry-ingest:{{ app_images_tag }}"
                name: oneuptime-open-telemetry-ingest
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3403
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3403
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3403
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "3403" 
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3403
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Otel Collector
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-otel-collector
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-otel-collector
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-otel-collector
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-otel-collector
              appname: oneuptime
          spec:
            volumes:
              - name: greenlockrc
                emptyDir:
                  sizeLimit: "1Gi"
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/otel-collector:{{ app_images_tag }}"
                name: oneuptime-otel-collector
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Liveness probe
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /health/status
                    port: 13133
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /health/status
                    port: 13133
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /health/status
                    port: 13133
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: PORT
                    value: "4317" 
                  - name: OPENTELEMETRY_COLLECTOR_SENDING_QUEUE_ENABLED
                    value: "true"
                  - name: OPENTELEMETRY_COLLECTOR_SENDING_QUEUE_NUM_CONSUMERS
                    value: "3"
                  - name: OPENTELEMETRY_COLLECTOR_SENDING_QUEUE_SIZE
                    value: "1000"
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 4318
                    protocol: TCP
                    name: http
                  - containerPort: 4317
                    protocol: TCP
                    name: grpc
            restartPolicy: Always

- name: Deployment - OneUptime - Probe Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-probe-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-probe-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-probe-ingest
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-probe-ingest
              appname: oneuptime
          spec:
            volumes:
              - name: greenlockrc
                emptyDir:
                  sizeLimit: "1Gi"
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/probe-ingest:{{ app_images_tag }}"
                name: oneuptime-probe-ingest
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3400
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3400
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3400
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "3400" 
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3400
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Probe One
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-probe-one
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-probe-one
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-probe-one
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-probe-one
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/probe:{{ app_images_tag }}"
                name: oneuptime-probe-one
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: Always
                env:
                  - name: LOG_LEVEL
                    value: INFO
                  - name: PORT
                    value: 
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: OPENTELEMETRY_EXPORTER_OTLP_ENDPOINT
                    value: 
                  - name: ONEUPTIME_URL
                    value: "http://oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local:3400"
                  - name: PROBE_NAME
                    value: Probe
                  - name: PROBE_DESCRIPTION
                    value: Probe
                  - name: PROBE_MONITORING_WORKERS
                    value: '3'
                  - name: PROBE_MONITOR_RETRY_LIMIT
                    value: '3'
                  # syntheticMonitorScriptTimeoutInMs
                  - name: PROBE_SYNTHETIC_MONITOR_SCRIPT_TIMEOUT_IN_MS
                    value: '60000'
                  - name: PROBE_CUSTOM_CODE_MONITOR_SCRIPT_TIMEOUT_IN_MS
                    value: '60000'
                  - name: PROBE_KEY
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: probe-one
                  - name: PROBE_MONITOR_FETCH_LIMIT
                    value: '10'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
            restartPolicy: Always

- name: Deployment - OneUptime - Server Monitor Ingest
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-server-monitor-ingest
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-server-monitor-ingest
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-server-monitor-ingest
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-server-monitor-ingest
              appname: oneuptime
          spec:
            volumes:
              - name: greenlockrc
                emptyDir:
                  sizeLimit: "1Gi"
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/server-monitor-ingest:{{ app_images_tag }}"
                name: oneuptime-server-monitor-ingest
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3404
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3404
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3404
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: "3404" 
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3404
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Status Page
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-status-page
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-status-page
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-status-page
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-status-page
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/status-page:{{ app_images_tag }}"
                name: oneuptime-status-page
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'false'
                  - name: DISABLE_TELEMETRY
                    value: 'false'
                  - name: OPENTELEMETRY_EXPORTER_OTLP_HEADERS
                    value: 
                  - name: PORT
                    value: '3105'
                ports:
                  - containerPort: 3105
                    protocol: TCP
                    name: port
            restartPolicy: Always

- name: Deployment - OneUptime - Worker
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-worker
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-worker
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-worker
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-worker
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/worker:{{ app_images_tag }}"
                name: oneuptime-worker
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 1445
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 1445
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 1445
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: PORT
                    value: "1445"
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 1445
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: Deployment - OneUptime - Workflow
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Deployment
      metadata:
        name: oneuptime-workflow
        namespace: "{{ openshift_namespace }}"
        labels:
          app: oneuptime-workflow
          app.kubernetes.io/part-of: oneuptime
          app.kubernetes.io/managed-by: Helm
          appname: oneuptime
      spec:
        selector:
          matchLabels:
            app: oneuptime-workflow
        replicas: 1
        template:
          metadata:
            labels:
              app: oneuptime-workflow
              appname: oneuptime
          spec:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - image: "{{ quay_registry }}/workflow:{{ app_images_tag }}"
                name: oneuptime-workflow
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                # Startup probe
                startupProbe:
                  httpGet:
                    path: /status/live
                    port: 3099
                  periodSeconds: 60
                  failureThreshold: 18
                # Liveness probe
                livenessProbe:
                  httpGet:
                    path: /status/live
                    port: 3099
                  periodSeconds: 60
                  timeoutSeconds: 120
                  initialDelaySeconds: 10
                # Readyness Probe
                readinessProbe:
                  httpGet:
                    path: /status/ready
                    port: 3099
                  periodSeconds: 60
                  initialDelaySeconds: 10
                  timeoutSeconds: 120
                imagePullPolicy: Always
                env:
                  - name: SLACK_APP_CLIENT_ID
                    value: 
                  - name: HOST
                    value: "{{ status_hostname }}"
                  - name: STATUS_PAGE_CNAME_RECORD
                    value: 
                  - name: ALLOWED_ACTIVE_MONITOR_COUNT_IN_FREE_PLAN
                    value: "10"
                  - name: OTEL_COLLECTOR_HOST
                    value: 
                  - name: LOG_LEVEL
                    value: INFO
                  - name: FLUENTD_HOST
                    value: 
                  - name: HTTP_PROTOCOL
                    value: https
                  - name: NODE_ENV
                    value: production
                  - name: BILLING_ENABLED
                    value: 'false'
                  - name: BILLING_PUBLIC_KEY
                    value: 
                  - name: SUBSCRIPTION_PLAN_BASIC
                    value: 
                  - name: SUBSCRIPTION_PLAN_GROWTH
                    value: 
                  - name: SUBSCRIPTION_PLAN_SCALE
                    value: 
                  - name: SUBSCRIPTION_PLAN_ENTERPRISE
                    value: 
                  - name: ANALYTICS_KEY
                    value: 
                  - name: ANALYTICS_HOST
                    value: 
                  - name: SERVER_ACCOUNTS_HOSTNAME
                    value: "oneuptime-accounts.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_SERVER_MONITOR_INGEST_HOSTNAME
                    value: "oneuptime-server-monitor-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ISOLATED_VM_HOSTNAME
                    value: "oneuptime-isolated-vm.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKFLOW_HOSTNAME
                    value: "oneuptime-workflow.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_WORKER_HOSTNAME
                    value: "oneuptime-worker.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_API_REFERENCE_HOSTNAME
                    value: "oneuptime-api-reference.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_HOME_HOSTNAME
                    value: "oneuptime-home.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_APP_HOSTNAME
                    value: "oneuptime-app.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_PROBE_INGEST_HOSTNAME
                    value: "oneuptime-probe-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_INCOMING_REQUEST_INGEST_HOSTNAME
                    value: "oneuptime-incoming-request-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_FLUENT_INGEST_HOSTNAME
                    value: "oneuptime-fluent-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OPEN_TELEMETRY_INGEST_HOSTNAME
                    value: "oneuptime-open-telemetry-ingest.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_TEST_SERVER_HOSTNAME
                    value: "oneuptime-test-server.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_OTEL_COLLECTOR_HOSTNAME
                    value: "oneuptime-otel-collector.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_STATUS_PAGE_HOSTNAME
                    value: "oneuptime-status-page.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DASHBOARD_HOSTNAME
                    value: "oneuptime-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_ADMIN_DASHBOARD_HOSTNAME
                    value: "oneuptime-admin-dashboard.{{ openshift_namespace }}.svc.cluster.local"
                  - name: SERVER_DOCS_HOSTNAME
                    value: "oneuptime-docs.{{ openshift_namespace }}.svc.cluster.local"
                  
                  - name: APP_PORT
                    value: '3002'
                  - name: PROBE_INGEST_PORT
                    value: '3400'
                  - name: SERVER_MONITOR_INGEST_PORT
                    value: '3404'
                  - name: OPEN_TELEMETRY_INGEST_PORT
                    value: '3403'
                  - name: INCOMING_REQUEST_INGEST_PORT
                    value: '3402'
                  - name: FLUENT_INGEST_PORT
                    value: '3401'
                  - name: TEST_SERVER_PORT
                    value: '3800'
                  - name: ACCOUNTS_PORT
                    value: '3003'
                  - name: ISOLATED_VM_PORT
                    value: '4572'
                  - name: HOME_PORT
                    value: '1444'
                  - name: WORKER_PORT
                    value: '1445'
                  - name: WORKFLOW_PORT
                    value: '3099'
                  - name: STATUS_PAGE_PORT
                    value: '3105'
                  - name: DASHBOARD_PORT
                    value: '3009'
                  - name: ADMIN_DASHBOARD_PORT
                    value: '3158'
                  - name: API_REFERENCE_PORT
                    value: '1446'
                  - name: DOCS_PORT
                    value: '1447'
                  
                  - name: IS_SERVER
                    value: 'true'
                  
                  - name: SLACK_APP_CLIENT_SECRET
                    value: 
                  
                  - name: SLACK_APP_SIGNING_SECRET
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_USER
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_CREATED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_DELETED_PROJECT
                    value: 
                  
                  - name: NOTIFICATION_SLACK_WEBHOOK_ON_SUBSCRIPTION_UPDATE
                    value: 
                  
                  - name: LETS_ENCRYPT_NOTIFICATION_EMAIL
                    value: 
                  
                  - name: LETS_ENCRYPT_ACCOUNT_KEY
                    value: 
                  
                  - name: ENCRYPTION_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: encryption-secret
                  
                  - name: CLICKHOUSE_USER
                    value: oneuptime
                  
                  - name: CLICKHOUSE_IS_HOST_HTTPS
                    value: 'false'
                  - name: CLICKHOUSE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-clickhouse
                          key: admin-password
                  - name: CLICKHOUSE_HOST
                    value: "oneuptime-clickhouse.{{ openshift_namespace }}.svc.cluster.local"
                  - name: CLICKHOUSE_PORT
                    value: '8123'
                  - name: CLICKHOUSE_DATABASE
                    value: 'oneuptime'
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  
                  
                  
                  
                  - name: REDIS_HOST
                    value: "oneuptime-redis-master.{{ openshift_namespace }}.svc.cluster.local"
                  - name: REDIS_PORT
                    value: "6379"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: oneuptime-redis
                          key: redis-password
                  - name: REDIS_IP_FAMILY
                    value: "4"
                  - name: REDIS_DB
                    value: '0'
                  - name: REDIS_USERNAME
                    value: default
                  
                  
                  ## REDIS SSL BLOCK
                  # do nothing here.
                  
                  # Postgres configuration
                  
                  - name: DATABASE_HOST
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: host
                  - name: DATABASE_PORT
                    value: '5432'
                  - name: DATABASE_USERNAME
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: username
                  - name: DATABASE_PASSWORD
                    valueFrom:
                      secretKeyRef:
                          name: postgres-cluster-app
                          key: password
                  - name: DATABASE_NAME
                    value: oneuptime
                  
                  
                  ## DATABASE SSL BLOCK
                  # do nothing here.
                  
                  ## DATABASE SSL ENDS HERE
                  
                  - name: BILLING_PRIVATE_KEY
                    value: 
                  
                  - name: DISABLE_AUTOMATIC_INCIDENT_CREATION
                    value: 'false'
                  
                  - name: DISABLE_AUTOMATIC_ALERT_CREATION
                    value: 'false'
                  
                  - name: WORKFLOW_SCRIPT_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: WORKFLOW_TIMEOUT_IN_MS
                    value: '5000'
                  
                  - name: ONEUPTIME_SECRET
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-secrets
                        key: oneuptime-secret
                  - name: PORT
                    value: "3099"
                  - name: DISABLE_TELEMETRY
                    value: "false"
                ports:
                  - containerPort: 3099
                    protocol: TCP
                    name: http
            restartPolicy: Always

- name: StatefulSet - OneUptime - Clickhouse
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: StatefulSet
      metadata:
        name: oneuptime-clickhouse-shard0
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: clickhouse
          app.kubernetes.io/version: 25.3.2
          helm.sh/chart: clickhouse-9.0.0
          app.kubernetes.io/component: clickhouse
          app.kubernetes.io/part-of: clickhouse
          shard: "0"
      spec:
        replicas: 1
        podManagementPolicy: "Parallel"
        selector:
          matchLabels:
            app.kubernetes.io/instance: oneuptime
            app.kubernetes.io/name: clickhouse
            app.kubernetes.io/component: clickhouse
            app.kubernetes.io/part-of: clickhouse
            shard: "0"
        serviceName: oneuptime-clickhouse-headless
        updateStrategy:
          rollingUpdate: {}
          type: RollingUpdate
        template:
          metadata:
            annotations:
              checksum/configd-configuration: ae5a3fb54886f334f6c9467066161382835afb146cb5a88ca77e65b98f96864f
            labels:
              app.kubernetes.io/instance: oneuptime
              app.kubernetes.io/managed-by: Helm
              app.kubernetes.io/name: clickhouse
              app.kubernetes.io/version: 25.3.2
              helm.sh/chart: clickhouse-9.0.0
              app.kubernetes.io/component: clickhouse
              app.kubernetes.io/part-of: clickhouse
              shard: "0"
          spec:
            automountServiceAccountToken: false
            serviceAccountName: oneuptime-clickhouse
            affinity:
              podAffinity:
              podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                  - podAffinityTerm:
                      labelSelector:
                        matchLabels:
                          app.kubernetes.io/instance: oneuptime
                          app.kubernetes.io/name: clickhouse
                          app.kubernetes.io/component: clickhouse
                      topologyKey: kubernetes.io/hostname
                    weight: 1
              nodeAffinity:
            securityContext:
              fsGroupChangePolicy: Always
              supplementalGroups: []
              sysctls: []
            initContainers:
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - name: clickhouse
                image: "{{ quay_registry }}/clickhouse:25.3.2-debian-12-r3"
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: IfNotPresent
                securityContext:
                  allowPrivilegeEscalation: false
                  capabilities:
                    drop:
                    - ALL
                  privileged: false
                  readOnlyRootFilesystem: true
                  runAsNonRoot: true
                  runAsUser: "{{ user_to_run }}"
                  seLinuxOptions:
                    level: "{{ se_linux_options_level }}"
                  seccompProfile:
                    type: RuntimeDefault
                env:
                  - name: BITNAMI_DEBUG
                    value: "false"
                  - name: CLICKHOUSE_HTTP_PORT
                    value: "8123"
                  - name: CLICKHOUSE_TCP_PORT
                    value: "9000"
                  - name: CLICKHOUSE_MYSQL_PORT
                    value: "9004"
                  - name: CLICKHOUSE_POSTGRESQL_PORT
                    value: "9005"
                  - name: CLICKHOUSE_INTERSERVER_HTTP_PORT
                    value: "9009"
                  - name: CLICKHOUSE_SHARD_ID
                    value: "shard0"
                  - name: CLICKHOUSE_REPLICA_ID
                    valueFrom:
                      fieldRef:
                        fieldPath: metadata.name
                  - name: CLICKHOUSE_ADMIN_USER
                    value: "oneuptime"
                  - name: CLICKHOUSE_ADMIN_PASSWORD_FILE
                    value: /opt/bitnami/clickhouse/secrets/admin-password
                ports:
                  - name: http
                    containerPort: 8123
                  - name: tcp
                    containerPort: 9000
                  - name: tcp-postgresql
                    containerPort: 9005
                  - name: tcp-mysql
                    containerPort: 9004
                  - name: http-intersrv
                    containerPort: 9009
                livenessProbe:
                  failureThreshold: 3
                  initialDelaySeconds: 10
                  periodSeconds: 10
                  successThreshold: 1
                  timeoutSeconds: 1
                  tcpSocket:
                    port: http
                readinessProbe:
                  failureThreshold: 3
                  initialDelaySeconds: 10
                  periodSeconds: 10
                  successThreshold: 1
                  timeoutSeconds: 1
                  httpGet:
                    path: /ping
                    port: http
                volumeMounts:
                  - name: data
                    mountPath: /bitnami/clickhouse
                  - name: configd-configuration
                    mountPath: /bitnami/clickhouse/etc/config.d
                  - name: secrets
                    mountPath: /opt/bitnami/clickhouse/secrets
                    readOnly: true
                  - name: empty-dir
                    mountPath: /opt/bitnami/clickhouse/etc
                    subPath: app-conf-dir
                  - name: empty-dir
                    mountPath: /opt/bitnami/clickhouse/logs
                    subPath: app-logs-dir
                  - name: empty-dir
                    mountPath: /opt/bitnami/clickhouse/tmp
                    subPath: app-tmp-dir
                  - name: empty-dir
                    mountPath: /tmp
                    subPath: tmp-dir
                  - name: custom-init-scripts
                    mountPath: /docker-entrypoint-initdb.d
            volumes:
              - name: empty-dir
                emptyDir: {}
              - name: configd-configuration
                configMap:
                  name: oneuptime-clickhouse-configd
              - name: secrets
                secret:
                  secretName: oneuptime-clickhouse
                  defaultMode: 256
              - name: custom-init-scripts
                secret:
                  secretName: oneuptime-clickhouse-init-scripts
        volumeClaimTemplates:
          - apiVersion: v1
            kind: PersistentVolumeClaim
            metadata:
              name: data
              labels:
                app.kubernetes.io/instance: oneuptime
                app.kubernetes.io/name: clickhouse
                app.kubernetes.io/component: clickhouse
            spec:
              accessModes:
                - "ReadWriteOnce"
              resources:
                requests:
                  storage: "10Gi"
              storageClassName: sc-gold

# - name: StatefulSet - OneUptime - Postgres
#   kubernetes.core.k8s:
#     definition:
#       apiVersion: v1
#       kind: StatefulSet
#       metadata:
#         name: oneuptime-postgresql
#         namespace: "{{ openshift_namespace }}"
#         labels:
#           app.kubernetes.io/instance: oneuptime
#           app.kubernetes.io/managed-by: Helm
#           app.kubernetes.io/name: postgresql
#           app.kubernetes.io/version: 16.1.0
#           helm.sh/chart: postgresql-14.0.0
#           app.kubernetes.io/component: primary
#       spec:
#         replicas: 1
#         serviceName: oneuptime-postgresql-hl
#         updateStrategy:
#           rollingUpdate: {}
#           type: RollingUpdate
#         selector:
#           matchLabels:
#             app.kubernetes.io/instance: oneuptime
#             app.kubernetes.io/name: postgresql
#             app.kubernetes.io/component: primary
#         template:
#           metadata:
#             name: oneuptime-postgresql
#             labels:
#               app.kubernetes.io/instance: oneuptime
#               app.kubernetes.io/managed-by: Helm
#               app.kubernetes.io/name: postgresql
#               app.kubernetes.io/version: 16.1.0
#               helm.sh/chart: postgresql-14.0.0
#               app.kubernetes.io/component: primary
#           spec:
#             serviceAccountName: oneuptime-postgresql
            
#             automountServiceAccountToken: false
#             affinity:
#               podAffinity:
                
#               podAntiAffinity:
#                 preferredDuringSchedulingIgnoredDuringExecution:
#                   - podAffinityTerm:
#                       labelSelector:
#                         matchLabels:
#                           app.kubernetes.io/instance: oneuptime
#                           app.kubernetes.io/name: postgresql
#                           app.kubernetes.io/component: primary
#                       topologyKey: kubernetes.io/hostname
#                     weight: 1
#               nodeAffinity:
                
#             securityContext:
#               fsGroupChangePolicy: Always
#               supplementalGroups: []
#               sysctls: []
#             hostNetwork: false
#             hostIPC: false
#             containers:
#               - name: postgresql
#                 image: docker.io/bitnami/postgresql:16.1.0-debian-11-r25
#                 resources:
#                   requests:
#                     cpu: 50m
#                     memory: 128Mi
#                 imagePullPolicy: "IfNotPresent"
#                 securityContext:
#                   allowPrivilegeEscalation: false
#                   capabilities:
#                     drop:
#                     - ALL
#                   privileged: false
#                   readOnlyRootFilesystem: false
#                   runAsNonRoot: true
#                   runAsUser: "{{ user_to_run }}"
#                   seccompProfile:
#                     type: RuntimeDefault
#                 env:
#                   - name: BITNAMI_DEBUG
#                     value: "false"
#                   - name: POSTGRESQL_PORT_NUMBER
#                     value: "5432"
#                   - name: POSTGRESQL_VOLUME_DIR
#                     value: "/bitnami/postgresql"
#                   - name: PGDATA
#                     value: "/bitnami/postgresql/data"
#                   # Authentication
#                   - name: POSTGRES_USER
#                     value: "oneuptime"
#                   - name: POSTGRES_PASSWORD
#                     valueFrom:
#                       secretKeyRef:
#                         name: oneuptime-postgresql
#                         key: password
#                   - name: POSTGRES_POSTGRES_PASSWORD
#                     valueFrom:
#                       secretKeyRef:
#                         name: oneuptime-postgresql
#                         key: postgres-password
#                   - name: POSTGRES_DATABASE
#                     value: "oneuptimedb"
#                   # Replication
#                   # Initdb
#                   # Standby
#                   # LDAP
#                   - name: POSTGRESQL_ENABLE_LDAP
#                     value: "no"
#                   # TLS
#                   - name: POSTGRESQL_ENABLE_TLS
#                     value: "no"
#                   # Audit
#                   - name: POSTGRESQL_LOG_HOSTNAME
#                     value: "false"
#                   - name: POSTGRESQL_LOG_CONNECTIONS
#                     value: "false"
#                   - name: POSTGRESQL_LOG_DISCONNECTIONS
#                     value: "false"
#                   - name: POSTGRESQL_PGAUDIT_LOG_CATALOG
#                     value: "off"
#                   # Others
#                   - name: POSTGRESQL_CLIENT_MIN_MESSAGES
#                     value: "error"
#                   - name: POSTGRESQL_SHARED_PRELOAD_LIBRARIES
#                     value: "pgaudit"
#                 ports:
#                   - name: tcp-postgresql
#                     containerPort: 5432
#                 livenessProbe:
#                   failureThreshold: 6
#                   initialDelaySeconds: 30
#                   periodSeconds: 10
#                   successThreshold: 1
#                   timeoutSeconds: 5
#                   exec:
#                     command:
#                       - /bin/sh
#                       - -c
#                       - exec pg_isready -U "oneuptime" -d "dbname=oneuptimedb" -h 127.0.0.1 -p 5432
#                 readinessProbe:
#                   failureThreshold: 6
#                   initialDelaySeconds: 5
#                   periodSeconds: 10
#                   successThreshold: 1
#                   timeoutSeconds: 5
#                   exec:
#                     command:
#                       - /bin/sh
#                       - -c
#                       - -e
#                       - |
#                         exec pg_isready -U "oneuptime" -d "dbname=oneuptimedb" -h 127.0.0.1 -p 5432
#                         [ -f /opt/bitnami/postgresql/tmp/.initialized ] || [ -f /bitnami/postgresql/.initialized ]
#                 resources:
#                   limits: {}
#                   requests:
#                     cpu: 250m
#                     memory: 256Mi
#                 volumeMounts:
#                   - name: dshm
#                     mountPath: /dev/shm
#                   - name: data
#                     mountPath: /bitnami/postgresql
#             volumes:
#               - name: dshm
#                 emptyDir:
#                   medium: Memory
#         volumeClaimTemplates:
#           - apiVersion: v1
#             kind: PersistentVolumeClaim
#             metadata:
#               name: data
#             spec:
#               accessModes:
#                 - "ReadWriteOnce"
#               resources:
#                 requests:
#                   storage: "10Gi"
#               storageClassName: sc-gold

- name: StatefulSet - OneUptime - Redis
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: StatefulSet
      metadata:
        name: oneuptime-redis-master
        namespace: "{{ openshift_namespace }}"
        labels:
          app.kubernetes.io/instance: oneuptime
          app.kubernetes.io/managed-by: Helm
          app.kubernetes.io/name: redis
          app.kubernetes.io/version: 7.2.4
          helm.sh/chart: redis-18.19.1
          app.kubernetes.io/component: master
      spec:
        replicas: 1
        selector:
          matchLabels:
            app.kubernetes.io/instance: oneuptime
            app.kubernetes.io/name: redis
            app.kubernetes.io/component: master
        serviceName: oneuptime-redis-headless
        updateStrategy:
          type: RollingUpdate
        template:
          metadata:
            labels:
              app.kubernetes.io/instance: oneuptime
              app.kubernetes.io/managed-by: Helm
              app.kubernetes.io/name: redis
              app.kubernetes.io/version: 7.2.4
              helm.sh/chart: redis-18.19.1
              app.kubernetes.io/component: master
            annotations:
              checksum/configmap: b80a98d43003b6ba444715c5099f8debc2981ec5c6f2de25b6b3b46c414885c3
              checksum/health: aff24913d801436ea469d8d374b2ddb3ec4c43ee7ab24663d5f8ff1a1b6991a9
              checksum/scripts: 560c33ff34d845009b51830c332aa05fa211444d1877d3526d3599be7543aaa5
              checksum/secret: 3a1f319b9065b59ef37865bc29d9ce21deb8a3423219f7c3c4c30eb414a9216b
          spec:
            
            securityContext:
              fsGroupChangePolicy: Always
              supplementalGroups: []
              sysctls: []
            serviceAccountName: oneuptime-redis-master
            automountServiceAccountToken: false
            affinity:
              podAffinity:
                
              podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                  - podAffinityTerm:
                      labelSelector:
                        matchLabels:
                          app.kubernetes.io/instance: oneuptime
                          app.kubernetes.io/name: redis
                          app.kubernetes.io/component: master
                      topologyKey: kubernetes.io/hostname
                    weight: 1
              nodeAffinity:
                
            enableServiceLinks: true
            terminationGracePeriodSeconds: 30
            imagePullSecrets:
              - name: status-pull-secret
            containers:
              - name: redis
                image: "{{ quay_registry }}/redis:7.2.4-debian-12-r9"
                resources:
                  requests:
                    cpu: 50m
                    memory: 128Mi
                imagePullPolicy: "IfNotPresent"
                securityContext:
                  allowPrivilegeEscalation: false
                  capabilities:
                    drop:
                    - ALL
                  readOnlyRootFilesystem: false
                  runAsNonRoot: true
                  runAsUser: "{{ user_to_run }}"
                  seccompProfile:
                    type: RuntimeDefault
                command:
                  - /bin/bash
                args:
                  - -c
                  - /opt/bitnami/scripts/start-scripts/start-master.sh
                env:
                  - name: BITNAMI_DEBUG
                    value: "false"
                  - name: REDIS_REPLICATION_MODE
                    value: master
                  - name: ALLOW_EMPTY_PASSWORD
                    value: "no"
                  - name: REDIS_PASSWORD
                    valueFrom:
                      secretKeyRef:
                        name: oneuptime-redis
                        key: redis-password
                  - name: REDIS_TLS_ENABLED
                    value: "no"
                  - name: REDIS_PORT
                    value: "6379"
                ports:
                  - name: redis
                    containerPort: 6379
                livenessProbe:
                  initialDelaySeconds: 20
                  periodSeconds: 5
                  # One second longer than command timeout should prevent generation of zombie processes.
                  timeoutSeconds: 6
                  successThreshold: 1
                  failureThreshold: 5
                  exec:
                    command:
                      - sh
                      - -c
                      - /health/ping_liveness_local.sh 5
                readinessProbe:
                  initialDelaySeconds: 20
                  periodSeconds: 5
                  timeoutSeconds: 2
                  successThreshold: 1
                  failureThreshold: 5
                  exec:
                    command:
                      - sh
                      - -c
                      - /health/ping_readiness_local.sh 1
                volumeMounts:
                  - name: start-scripts
                    mountPath: /opt/bitnami/scripts/start-scripts
                  - name: health
                    mountPath: /health
                  - name: redis-data
                    mountPath: /data
                  - name: config
                    mountPath: /opt/bitnami/redis/mounted-etc
                  - name: empty-dir
                    mountPath: /opt/bitnami/redis/etc/
                    subPath: app-conf-dir
                  - name: empty-dir
                    mountPath: /tmp
                    subPath: tmp-dir
            volumes:
              - name: start-scripts
                configMap:
                  name: oneuptime-redis-scripts
                  defaultMode: 0755
              - name: health
                configMap:
                  name: oneuptime-redis-health
                  defaultMode: 0755
              - name: config
                configMap:
                  name: oneuptime-redis-configuration
              - name: empty-dir
                emptyDir: {}
              - name: redis-data
                emptyDir: {}

- name: Ingress - OneUptime
  kubernetes.core.k8s:
    definition:
      apiVersion: networking.k8s.io/v1
      kind: Ingress
      metadata:
        name: oneuptime-ingress
        namespace: "{{ openshift_namespace }}"
        labels:
            app: oneuptime-ingress
            app.kubernetes.io/part-of: oneuptime
            app.kubernetes.io/managed-by: Helm
            appname: oneuptime
      spec:
        ingressClassName: nginx
        rules:
          - host: "{{ status_hostname }}"
            http:
              paths:
                - path: /
                  pathType: Prefix
                  backend:
                    service:
                      name: oneuptime-nginx
                      port:
                        name: "oneuptime-http"

- name: Route - OneUptime
  kubernetes.core.k8s:
    definition:
      apiVersion: route.openshift.io/v1
      kind: Route
      metadata:
        name: status-route
        namespace: "{{ openshift_namespace }}"
        labels:
          route: "{{ route_privacy }}"
      spec:
        host: "{{ status_hostname }}"
        to:
          kind: Service
          name: oneuptime-nginx
          weight: 100
        port:
          targetPort: oneuptime-http
        tls:
          termination: edge
          insecureEdgeTerminationPolicy: Redirect
        wildcardPolicy: None